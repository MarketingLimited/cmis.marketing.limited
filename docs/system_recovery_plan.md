# ๐งฏ CMIS System Recovery Plan โ v15.1

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-10  
**ุงููุณุคูู:** ูุฑูู ุงูุชุดุบูู ุงูุฅุฏุฑุงูู (Cognitive DevOps)

---

## ๐ฏ ุงููุฏู

ุชูููุฑ ุฎุทุฉ ุงุณุชุนุงุฏุฉ ูุชูุงููุฉ ูู ุญุงู ุญุฏูุซ ุฃู ุฎูู ุจูููู ุฃู ููุฏุงู ุจูุงูุงุช ุฏุงุฎู ุจูุฆุฉ CMISุ ูุถูุงู ุงูุนูุฏุฉ ุฅูู ุงูุญุงูุฉ ุงูุชุดุบูููุฉ ุงููุงููุฉ ุจุฃูู ุฒูู ุชููู ูููู.

---

## โ๏ธ ูุทุงู ุงูุฎุทุฉ (Scope)

ุชุดูู ูุฐู ุงูุฎุทุฉ ุงูุนูุงุตุฑ ุงูุชุงููุฉ:

| ุงููููู | ุงููุทุงู |
|---------|---------|
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | PostgreSQL (Schemas: `cmis`, `cmis_knowledge`, `cmis_dev`) |
| ุชุทุจูู Laravel | `/public_html/app` ููููุงุช ุงูุจูุฆุฉ `.env` |
| ุงูุชุถูููุงุช ูุงูุจุญุซ | ุฌุฏุงูู `embedding_update_queue`, `semantic_search_logs` |
| ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ | `/mnt/backups/` ู`archive/` |

---

## ๐จ ุงูุฃุนุทุงู ุงููุญุชููุฉ

| ููุน ุงูุนุทู | ุงูุณุจุจ ุงูุดุงุฆุน | ูุณุชูู ุงูุฎุทูุฑุฉ |
|-------------|----------------|----------------|
| ุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุงููุทุงุน ุฃุซูุงุก ูุชุงุจุฉ ุฃู ุชุฑููุฉ PostgreSQL | ๐ด ูุฑุชูุน |
| ูุดู Queue | ุงุฒุฏูุงุฌ ุฃู ููุฏุงู ุณุฌูุงุช `embedding_update_queue` | ๐ ูุชูุณุท |
| ุญุฐู ูููุงุช ุงูุชุทุจูู | ุชุญุฏูุซ ุบูุฑ ูุฑุงูุจ ุฃู ุฎุทุฃ Git | ๐ด ูุฑุชูุน |
| ุชููู ูุงุฌูุงุช OpenAI | ุงููุทุงุน ุงูุฅูุชุฑูุช ุฃู ุชุฌุงูุฒ ุงูุญุฏ ุงูุดูุฑู | ๐ก ููุฎูุถ |
| ููุฏุงู ุจูุงูุงุช ุงูุจุญุซ | ุชูุธูู ุบูุฑ ููุตูุฏ ุฃู ูุดู cron | ๐ข ููุฎูุถ |

---

## ๐งฉ ุฎุทุฉ ุงูุงุณุชุนุงุฏุฉ ุจุงูุฎุทูุงุช

### 1๏ธโฃ ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุณุฎุฉ ุงูุฃุฎูุฑุฉ

```bash
psql -U begin -W -d cmis < /mnt/backups/cmis_full_backup_latest.dump
```

> **ููุงุญุธุฉ:** ูููู ุชุญุฏูุฏ ูุณุฎุฉ ูุญุฏุฏุฉ ุจุงููุณุงุฑ ุงููุงูู ูุซู `/mnt/backups/cmis_full_backup_2025-11-10.dump`

---

### 2๏ธโฃ ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฑุณ (Post-Recovery)

```sql
REINDEX SCHEMA cmis;
REINDEX SCHEMA cmis_knowledge;
VACUUM (FULL, ANALYZE);
```

---

### 3๏ธโฃ ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช

```sql
SELECT COUNT(*) FROM cmis_knowledge.index;
SELECT COUNT(*) FROM cmis_knowledge.embedding_update_queue;
```

> ุฅุฐุง ูุงูุช ุงููุชุงุฆุฌ ุบูุฑ ูุชุทุงุจูุฉ ูุน ุงููุณุฎุฉ ุงูุณุงุจูุฉุ ูู ุจุชุดุบูู ุนูููุฉ ุชุตุญูุญ:
```sql
SELECT cmis_knowledge.repair_orphan_knowledge();
```

---

### 4๏ธโฃ ุฅุนุงุฏุฉ ุชูุนูู ููุงู Laravel

```bash
php artisan migrate --force
php artisan cmis:process-embeddings --batch-size=50
php artisan queue:restart
```

---

### 5๏ธโฃ ุงูุชุญูู ูู ุงูุทุจูุงุช ุงููุนุฑููุฉ

```bash
php artisan cmis:diagnose --full
```
- ูุชุฃูุฏ ูุฐุง ุงูุฃูุฑ ูู ุนูู `semantic_search_advanced()` ู`auto_feedback_from_logs()` ุจุดูู ุณููู.

---

### 6๏ธโฃ ุฅุนุงุฏุฉ ุชููุฆุฉ ุงูููุงู ุงููุฌุฏููุฉ (cron)

```bash
crontab -l | grep cmis
```
ุชุฃูุฏ ูู ูุฌูุฏ ุงูููุงู ุงูุชุงููุฉ:
```
0 */3 * * * php /home/cmis/public_html/artisan cmis:process-embeddings --batch-size=50
0 3 * * * psql -d cmis -c "SELECT cmis_knowledge.auto_feedback_from_logs();"
```

---

## ๐ง ุฎุทุฉ ุงุฎุชุจุงุฑ ูุง ุจุนุฏ ุงูุงุณุชุนุงุฏุฉ

1. ุชูููุฐ ุงุณุชุนูุงู ุจุญุซ ุฏูุงูู ุชุฌุฑูุจู:
   ```sql
   SELECT * FROM cmis_knowledge.semantic_search_advanced('marketing automation');
   ```
2. ูุญุต ุญุงูุฉ Queue:
   ```bash
   php artisan cmis:embedding-status
   ```
3. ุงูุชุฃูุฏ ูู ุชุดุบูู Triggers:
   ```sql
   SELECT * FROM information_schema.triggers WHERE trigger_schema IN ('cmis', 'cmis_knowledge');
   ```

---

## ๐งพ ุงูุฅุจูุงุบ ูุงูุชุตุนูุฏ

| ุงููุฑุญูุฉ | ุฌูุฉ ุงูุฅุจูุงุบ | ุงููุณููุฉ |
|----------|---------------|-----------|
| ุงูุชุดุงู ุงููุดููุฉ | ูุฑูู DevOps | Slack โ `#cmis-alerts` |
| ูุดู ุงูุงุณุชุนุงุฏุฉ ุงูุฃูููุฉ | ูุฏูุฑ ุงููุธุงู | ุจุฑูุฏ: `ops@cmis.ai` |
| ูุดู ูุงูู ุฃู ุชูู ุงููุณุฎ | ุงูุฅุฏุงุฑุฉ ุงูุชูููุฉ ุงูุนููุง | ููุงููุฉ ุทุงุฑุฆุฉ + Slack |

---

## ๐ ุชูุตูุงุช ุฃูููุฉ

- ูุง ุชูุฎุฒู ููุงุชูุญ API ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ.  
- ุงุณุชุฎุฏู `pg_dump --exclude-table-data` ุนูุฏ ูุณุฎ ุฌุฏุงูู ุญุณุงุณุฉ.  
- ุงุญูุธ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู `begin` ูู ุฎุฒุงู ุขูู ููุท (`/etc/cmis/secure.env`).

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ:** CMIS Orchestrator v15.1  
**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-11-10  
**ุงูุบุฑุถ:** ุงุณุชุนุงุฏุฉ ุงููุธุงู ุฎูุงู < 30 ุฏูููุฉ ูู ุฃู ุนุทู ุจูููู.