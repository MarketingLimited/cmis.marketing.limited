<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
  <testsuite name="/home/user/cmis.marketing.limited/phpunit.xml" tests="1" assertions="1" errors="0" failures="1" skipped="0" time="14.431445">
    <testsuite name="Feature" tests="1" assertions="1" errors="0" failures="1" skipped="0" time="14.431445">
      <testsuite name="Tests\Feature\Controllers\LeadControllerTest" file="/home/user/cmis.marketing.limited/tests/Feature/Controllers/LeadControllerTest.php" tests="1" assertions="1" errors="0" failures="1" skipped="0" time="14.431445">
        <testcase name="it_can_convert_lead" file="/home/user/cmis.marketing.limited/tests/Feature/Controllers/LeadControllerTest.php" line="213" class="Tests\Feature\Controllers\LeadControllerTest" classname="Tests.Feature.Controllers.LeadControllerTest" assertions="1" time="14.431445">
          <failure type="PHPUnit\Framework\ExpectationFailedException">Tests\Feature\Controllers\LeadControllerTest::it_can_convert_lead
Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.

/home/user/cmis.marketing.limited/vendor/laravel/framework/src/Illuminate/Testing/TestResponseAssert.php:45
/home/user/cmis.marketing.limited/vendor/laravel/framework/src/Illuminate/Testing/TestResponse.php:174
/home/user/cmis.marketing.limited/tests/Feature/Controllers/LeadControllerTest.php:231</failure>
          <system-out>Enabling RLS on cmis.orgs...
Enabling RLS on cmis.org_markets...
Enabling RLS on cmis.user_orgs...
Enabling RLS on cmis.campaigns...
Enabling RLS on cmis.content_plans...
Enabling RLS on cmis.content_items...
Enabling RLS on cmis.creative_assets...
Enabling RLS on cmis.ad_accounts...
Enabling RLS on cmis.ad_campaigns...
Enabling RLS on cmis.ad_sets...
Enabling RLS on cmis.ad_entities...
Enabling RLS on cmis.ad_metrics...
Creating RLS policy for cmis.orgs...
Creating RLS policy for cmis.org_markets...
Creating RLS policy for cmis.user_orgs...
Creating RLS policy for cmis.campaigns...
Creating RLS policy for cmis.content_plans...
Creating RLS policy for cmis.content_items...
Creating RLS policy for cmis.creative_assets...
Creating RLS policy for cmis.ad_accounts...
Creating RLS policy for cmis.ad_campaigns...
Creating RLS policy for cmis.ad_sets...
Creating RLS policy for cmis.ad_entities...
Creating RLS policy for cmis.ad_metrics...
Row-Level Security enabled successfully!

‚ö†Ô∏è  CRITICAL MIGRATION: Converting users.user_id from BIGINT to UUID
This will invalidate all existing user sessions and API tokens.
Press Ctrl+C within 10 seconds to abort...

Step 1/10: Checking current schema...
‚úì Users table already uses UUID. Skipping migration.

üìä Adding performance indexes...

Creating indexes for campaigns table...
‚úì Created index: idx_campaigns_org_status
‚úì Created index: idx_campaigns_dates
‚úì Created index: idx_campaigns_created
Creating indexes for content_plans table...
‚úì Created index: idx_content_plans_campaign
‚úì Created index: idx_content_plans_org_created
Creating indexes for content_items table...
‚ö† Warning: Could not create index idx_content_items_plan: SQLSTATE[42703]: Undefined column: 7 ERROR:  column "content_plan_id" does not exist (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_content_items_plan
                    ON cmis.content_items (content_plan_id)
                )
‚ö† Warning: Could not create index idx_content_items_status: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_content_items_status
                    ON cmis.content_items (status, scheduled_at)
                )
Creating indexes for knowledge_base table...
‚ö† Warning: Could not create index idx_knowledge_org_type: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_knowledge_org_type
                    ON cmis.knowledge_base (org_id, content_type)
                )
‚ö† Warning: Could not create index idx_knowledge_created: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_knowledge_created
                    ON cmis.knowledge_base (created_at DESC)
                )
‚ö† Warning: Could not create index idx_knowledge_title: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_knowledge_title
                    ON cmis.knowledge_base (title)
                )
Creating vector index for knowledge_embeddings table...
‚ö† Warning: Could not create index idx_embeddings_vector: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_embeddings_vector
                    ON cmis.knowledge_embeddings
                    USING ivfflat (embedding vector_cosine_ops)
                )
‚ö† Warning: Could not create index idx_embeddings_knowledge: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_embeddings_knowledge
                    ON cmis.knowledge_embeddings (knowledge_id)
                )
Creating indexes for ad_accounts table...
‚ö† Warning: Could not create index idx_ad_accounts_org: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_accounts_org
                    ON cmis.ad_accounts (org_id, platform)
                )
‚ö† Warning: Could not create index idx_ad_accounts_status: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_accounts_status
                    ON cmis.ad_accounts (status)
                )
Creating indexes for ad_campaigns table...
‚ö† Warning: Could not create index idx_ad_campaigns_account: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_campaigns_account
                    ON cmis.ad_campaigns (ad_account_id, status)
                )
‚ö† Warning: Could not create index idx_ad_campaigns_dates: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_campaigns_dates
                    ON cmis.ad_campaigns (start_date, end_date)
                )
Creating indexes for ad_metrics table...
‚ö† Warning: Could not create index idx_ad_metrics_entity_date: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_metrics_entity_date
                    ON cmis.ad_metrics (ad_entity_id, recorded_at DESC)
                )
‚ö† Warning: Could not create index idx_ad_metrics_date: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_metrics_date
                    ON cmis.ad_metrics (recorded_at DESC)
                )
‚ö† Warning: Could not create index idx_ad_metrics_campaign: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_ad_metrics_campaign
                    ON cmis.ad_metrics (ad_campaign_id, recorded_at DESC)
                )
Creating indexes for user_orgs table...
‚ö† Warning: Could not create index idx_user_orgs_user: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_user_orgs_user
                    ON cmis.user_orgs (user_id, is_active)
                )
‚ö† Warning: Could not create index idx_user_orgs_org: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_user_orgs_org
                    ON cmis.user_orgs (org_id, is_active)
                )
Creating indexes for creative_assets table...
‚ö† Warning: Could not create index idx_creative_assets_org: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_creative_assets_org
                    ON cmis.creative_assets (org_id, asset_type)
                )
‚ö† Warning: Could not create index idx_creative_assets_created: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_creative_assets_created
                    ON cmis.creative_assets (created_at DESC)
                )
Creating indexes for compliance_audits table...
‚ö† Warning: Could not create index idx_compliance_audits_content: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_compliance_audits_content
                    ON cmis.compliance_audits (content_item_id)
                )
‚ö† Warning: Could not create index idx_compliance_audits_status: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_compliance_audits_status
                    ON cmis.compliance_audits (status, created_at DESC)
                )
Creating indexes for activity_logs table...
‚ö† Warning: Could not create index idx_audit_user_date: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_audit_user_date
                    ON cmis_audit.activity_logs (user_id, created_at DESC)
                )
‚ö† Warning: Could not create index idx_audit_action: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_audit_action
                    ON cmis_audit.activity_logs (action, created_at DESC)
                )
‚ö† Warning: Could not create index idx_audit_model: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_audit_model
                    ON cmis_audit.activity_logs (model_type, model_id)
                )
Creating indexes for personal_access_tokens table...
‚ö† Warning: Could not create index idx_tokens_tokenable: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_tokens_tokenable
                    ON personal_access_tokens (tokenable_type, tokenable_id)
                )
‚ö† Warning: Could not create index idx_tokens_created: SQLSTATE[25P02]: In failed sql transaction: 7 ERROR:  current transaction is aborted, commands ignored until end of transaction block (Connection: pgsql, SQL: 
                    CREATE INDEX IF NOT EXISTS idx_tokens_created
                    ON personal_access_tokens (created_at DESC)
                )

‚úì All performance indexes created successfully!
‚úì Query performance should be significantly improved


üìä Adding foreign key constraints for user reference columns...

‚ö†Ô∏è  Could not add FK fk_user_permissions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_user_activities_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_user_sessions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_sessions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_scheduled_social_posts_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_security_context_audit_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_audience_templates_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_campaign_context_links_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_campaigns_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_integrations_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_roles_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_campaign_context_links_updated_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_integrations_updated_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_team_invitations_invited_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...
‚ö†Ô∏è  Could not add FK fk_user_orgs_invited_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint matching given keys fo...

‚úÖ Foreign key migration complete!
   Added: 0
   Skipped: 15

‚úì Fixed performance_metrics constraints
‚úì Notifications table created with RLS policies

üìä Creating foreign keys directly...

‚ö†Ô∏è  Could not add FK fk_user_permissions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_user_activities_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_user_sessions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_sessions_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_scheduled_social_posts_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_security_context_audit_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_notifications_user: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_audience_templates_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_campaign_context_links_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_campaigns_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_integrations_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_roles_created_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_campaign_context_links_updated_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_integrations_updated_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_team_invitations_invited_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚ö†Ô∏è  Could not add FK fk_user_orgs_invited_by: SQLSTATE[42830]: Invalid foreign key: 7 ERROR:  there is no unique constraint ma...
‚úì Added FK: fk_notifications_org on cmis.notifications.org_id -&gt; cmis.orgs.org_id

‚úÖ Foreign key creation complete!
   Added: 1
   Skipped: 16

‚úì Added updated_at to cmis.orgs
‚úì Added created_at to cmis.user_orgs
‚úì Added updated_at to cmis.user_orgs
‚úì Added created_at to cmis.org_markets
‚úì Added updated_at to cmis.org_markets
‚úì Added updated_at to cmis.ad_campaigns
‚úì Added updated_at to cmis.ad_metrics
‚úì Added updated_at to cmis.ai_actions
‚úì Added updated_at to cmis.ai_generated_campaigns
‚úì Added updated_at to cmis.ai_models
‚úì Added updated_at to cmis.cognitive_tracker_template
‚úì Added updated_at to cmis.cognitive_trends
‚úì Added updated_at to cmis.compliance_audits
‚úì Added updated_at to cmis.content_plans
‚úì Added updated_at to cmis.contexts
‚úì Added updated_at to cmis.contexts_base
‚úì Added updated_at to cmis.copy_components
‚úì Added updated_at to cmis.creative_assets
‚úì Added updated_at to cmis.creative_briefs
‚úì Added updated_at to cmis.experiments
‚úì Added updated_at to cmis.export_bundles
‚úì Added updated_at to cmis.field_definitions
‚úì Added updated_at to cmis.field_values
‚úì Added updated_at to cmis.job_batches
‚úì Added updated_at to cmis.jobs
‚úì Added updated_at to cmis.meta_documentation
‚úì Added updated_at to cmis.meta_field_dictionary
‚úì Added updated_at to cmis.meta_function_descriptions
‚úì Added updated_at to cmis.offerings_full_details
‚úì Added updated_at to cmis.offerings_old
‚úì Added updated_at to cmis.password_reset_tokens
‚úì Added updated_at to cmis.predictive_visual_engine
‚úì Added updated_at to cmis.reference_entities
‚úì Added updated_at to cmis.roles
‚úì Added updated_at to cmis.security_context_audit
‚úì Added updated_at to cmis.social_post_metrics
‚úì Added updated_at to cmis.social_posts
‚úì Added updated_at to cmis.team_account_access
‚úì Added updated_at to cmis.user_activities
‚úì Added updated_at to cmis.user_sessions
‚úì Added updated_at to cmis.value_contexts
‚úì Added created_at to cmis.permissions
‚úì Added updated_at to cmis.permissions
‚úì Added created_at to cmis.role_permissions
‚úì Added updated_at to cmis.role_permissions
‚úì Added created_at to cmis.user_permissions
‚úì Added updated_at to cmis.user_permissions
‚úì Added created_at to cmis.social_accounts
‚úì Added created_at to cmis.team_invitations
‚úì Added updated_at to cmis.team_invitations
‚úì Added created_at to cmis.sessions
‚úì Added updated_at to cmis.sessions
‚úì Added current_org_id to cmis.users
‚úì Added status to cmis.users
‚úì Added id column to cmis.notifications
‚úì Created transaction context functions
‚úì Added notifiable_type and notifiable_id to cmis.notifications
‚úì Added post_id to cmis.scheduled_social_posts
‚úì Added metadata to cmis.users
‚úì Added primary key to cmis.users(user_id)
‚úì Added account_username to cmis.integrations
‚úì Added account_name to cmis.integrations
‚úì Added refresh_token to cmis.integrations
‚úì Added token_expires_at to cmis.integrations
‚úì Added expires_at to cmis.integrations
‚úì Added status to cmis.integrations
‚úì Added metadata to cmis.integrations
‚úì Added scopes to cmis.integrations
‚úì Added user_org_id to cmis.user_orgs
‚úì Added invited_at to cmis.user_orgs
‚úì Made campaign_external_id nullable in cmis.ad_campaigns
‚úì Created table: cmis.team_members
‚úì Created table: cmis.leads
‚úì Created table: cmis.webhooks
‚úì Created table: cmis.contacts
‚úì Created table: cmis.knowledge_index
‚úì Created table: cmis.subscriptions
‚úì Created table: cmis.api_logs
‚úì Created table: cmis.content_plan_items
‚úì Created table: cmis.offerings
‚úì Created table: cmis.content
‚úì Created table: cmis.platform_connections
‚úì Created table: cmis.assets
‚úì Created table: cmis.invoices
‚úì Created table: cmis.audiences
‚úì Created table: cmis.templates
‚úì Created table: cmis.posts
‚úì Created table: cmis.custom_fields
‚úì Created table: cmis.comments
‚úì Created table: cmis.budgets
‚úì Created table: cmis.audit_logs

‚úÖ Migration complete! Created 20 missing tables.
‚úì Added code column to public.markets
‚úì Updated cmis.markets view to include code column
‚úì Added name column to cmis.permissions

‚úÖ Added missing columns successfully!
</system-out>
        </testcase>
      </testsuite>
    </testsuite>
  </testsuite>
</testsuites>
